@inject NavigationManager NavigationManager
@implements IDisposable

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        @foreach (var segment in segments)
        {
            <li class="breadcrumb-item">
                <a href="@segment.Url">@segment.Name</a>
            </li>
        }
    </ol>
</nav>

@code {
    private List<BreadcrumbSegment> segments = new List<BreadcrumbSegment>();

    protected override void OnInitialized()
    {
        UpdateSegments();
        NavigationManager.LocationChanged += HandleLocationChanged;
    }

    private void HandleLocationChanged(object sender, LocationChangedEventArgs e)
    {
        UpdateSegments();
        StateHasChanged();
    }

    private void UpdateSegments()
    {
        var uri = new Uri(NavigationManager.Uri);
        var pathSegments = uri.AbsolutePath.Split(new[] { '/' }, StringSplitOptions.RemoveEmptyEntries);
        segments.Clear();
        var accumulatedPath = "";
        foreach (var segment in pathSegments)
        {
            accumulatedPath += "/" + segment;
            segments.Add(new BreadcrumbSegment { Name = segment, Url = accumulatedPath });
        }
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= HandleLocationChanged;
    }

    private class BreadcrumbSegment
    {
        public string Name { get; set; }
        public string Url { get; set; }
    }
}
